# bridges 폴더 작업 일지

**작성일**: 2025-11-04
**작업자**: Claude Code

---

## 📋 작업 개요

bridges 폴더의 항암제 데이터 구조화 및 정규화 작업 진행

---

## 📅 Timeline

### 2025-10-31: bridges 폴더 최초 생성
- `anticancer_master.csv` 생성 (12:02)
  - 소스: `data/pharmalex_unity/merged_pharma_data_20250915_102415.csv`
  - 방법: ATC L01/L02 필터링
  - 결과: 154개 성분, 939개 브랜드명
  - 스크립트: `scripts/build_anticancer_bridge.py`

- `anticancer_master_clean.csv` 생성 (13:09)
  - 브랜드명 정제 (Phase 1)
  - 한글 성분명 추출
  - 대표 브랜드명 선정

### 2025-11-04: 데이터 정규화 작업 (오늘)
- `anticancer_normalized.csv` 생성 (09:42)
  - 1 제품 = 1 행 구조로 변환
  - 1,001개 제품으로 확장
  - ⚠️ 제조사 매핑 불완전

- `anticancer_normalized_v2.csv` 생성 (09:45) ✅ **최종**
  - HIRA dictionary 조인
  - 제조사 100% 매핑
  - 약가 정보 추가
  - 세대 정보 추가 (`anticancer_with_generation.csv`)

---

## 📊 데이터 현황

### bridges 폴더 구조

```
bridges/
├── [Master 데이터]
│   ├── anticancer_master.csv (154행)           2025-10-31
│   └── anticancer_master_clean.csv (154행)     2025-10-31
│
├── [Normalized 데이터] ✅ 권장
│   ├── anticancer_normalized_v2.csv (1,001행)  2025-11-04
│   ├── anticancer_normalized_v2.json           2025-11-04
│   └── anticancer_with_generation.csv          2025-11-04
│
├── [분석 스크립트]
│   ├── normalize_anticancer_v2.py              정규화
│   ├── analyze_normalized_data.py              통계 분석
│   ├── analyze_anticancer_generation.py        세대 분류
│   └── find_missing_anticancer_v2.py           누락 검증
│
└── [문서]
    ├── INDEX.md                                데이터 색인
    ├── ATC_MAPPING_ANALYSIS.md                 ATC 분석
    └── JOURNAL_2025-11-04.md                   이 문서
```

---

## 🔗 외부 데이터 연결 가능성

### 1. NCC (국립암센터) 암정보 사전 ✅ 연결 가능

#### 기본 정보
- **소스**: `ncc/cancer_dictionary/`
- **데이터**: 3,543개 의학 용어
- **LLM 분류**: gpt-4o-mini 사용 (70개 배치 파일)
- **카테고리**: 치료, 검사/진단, 증상, 질병/부위 등 7개

#### 연결 방법
```
bridges/anticancer_normalized_v2.csv (1,001개 제품)
  ↓ 약물명 매칭
NCC 치료 카테고리 (항암제 설명 포함)
  ↓ 조인
anticancer_with_descriptions.csv
```

#### 매칭 가능 항목 (확인됨)
- **5-FU** → "5-플루오로우라실(5-fluorouracil)의 약어..."
- **5-플루오로우라실** → "강력한 화학요법 약제의 하나. DNA의 합성을 방해..."
- 기타 주요 항암제도 포함 (시스플라틴, 독소루비신 등)

#### 연결 시 이점
1. 각 항암제에 대한 **국문 설명** 추가
2. **일반인이 이해하기 쉬운 용어**로 설명
3. RAG 시스템 구축 시 컨텍스트 제공

#### 구현 방법
```python
# 1. NCC '치료' 카테고리에서 약물 추출
ncc_drugs = [d for d in ncc_data if d['final_category'] == '치료']

# 2. bridges 약물명과 부분 매칭
for drug in bridges_df:
    matched = find_ncc_drug(drug['ingredient_ko'])
    if matched:
        drug['ncc_description'] = matched['content']

# 3. 통합 CSV 저장
df.to_csv('anticancer_with_descriptions.csv')
```

---

### 2. HIRA 항암화학요법 급여기준 ✅ 연결 가능

#### 기본 정보
- **소스**: `hira_cancer/`
- **데이터**: 659개 승인 요법, 248개 테이블
- **내용**: FOLFOX, FOLFIRI, R-CHOP, ABVD 등 치료 레짐

#### 연결 방법
```
bridges/anticancer_normalized_v2.csv
  ↓ 성분명 매칭
hira_cancer 승인 요법 (치료 프로토콜)
  ↓ 조인
anticancer_with_regimens.csv
```

#### 연결 시 이점
1. 각 항암제가 **어떤 치료 프로토콜에 사용되는지** 정보
2. **급여 기준** 정보
3. **병용 요법** 정보

---

### 3. MFDS 허가정보 ⚠️ 연결 검토 필요

#### 기본 정보
- **소스**: `mfds/greek_drugs_master.json`
- **내용**: 의약품 허가 정보

#### 연결 가능성
- 제품코드 기반 매칭 가능
- 효능효과, 용법용량 정보 추가 가능
- **추가 확인 필요**: MFDS 데이터 구조 분석

---

## ✅ 데이터 품질 검증 (오늘 수행)

### ATC 코드 누락 검증
- **결과**: 0개 누락 ✅
- **방법**: ATC 없는 약제 11,392개 중 항암제 키워드 검색
- **false positive 제거**: 암로디핀, 암브록솔 등 비항암제 제외
- **결론**: 현재 bridges 데이터 완전함

### 제조사 매핑 검증
- **결과**: 100% 매핑 ✅
- **방법**: HIRA dictionary 제품코드 기반 조인
- **매칭률**: 986/986 (bridges 제품코드 전체)

---

## 📈 데이터 통계

### 최종 데이터 (anticancer_normalized_v2.csv)

| 항목 | 수치 |
|------|------|
| 총 제품 수 | 1,001개 |
| 고유 성분 | 154개 |
| 제조사 | 121개 |
| ATC 코드 | 138개 |
| 평균 약가 | 952,060원 |
| 최고가 | 킴리아주 (3.6억원) |

### 세대별 분포

| 세대 | 제품 수 | 비율 |
|------|---------|------|
| 1세대 (세포독성) | 574개 | 57.3% |
| 2세대 (표적치료) | 182개 | 18.2% |
| 호르몬요법 | 153개 | 15.3% |
| 단일클론항체 | 41개 | 4.1% |
| 3세대 (면역항암) | 9개 | 0.9% |
| 기타 | 42개 | 4.2% |

---

## 🎯 다음 단계 (보류)

### Phase 2: 외부 데이터 연결
- [ ] NCC 설명 추가 (보류)
- [ ] HIRA 치료 레짐 연결 (보류)
- [ ] MFDS 허가정보 연결 (검토 필요)

### Phase 3: 데이터 고도화
- [ ] 한글명 보완 + 염/기본형 분리
- [ ] ATC 세분류 매핑
- [ ] 적응증 정보 추가

### Phase 4: 서비스 준비
- [ ] API 엔드포인트 설계
- [ ] 검색 인덱스 구축
- [ ] RAG 시스템 통합

---

## 📝 기술 노트

### 성공 요인
1. **ATC 코드 기반 필터링**: WHO 표준 분류 활용
2. **HIRA dictionary 조인**: 제품코드 기반 정확한 매핑
3. **단계별 검증**: ATC 누락, 제조사 매핑 등

### 교훈
1. **키워드 검색의 한계**: "암" 자가 포함된 비항암제 오탐지
2. **외부 데이터 중요성**: HIRA, NCC, MFDS 등 다중 소스 필요
3. **데이터 계보 추적**: 원천부터 최종까지 명확한 문서화

---

## 🔍 참고 자료

### 원천 데이터
- HIRA 약가 마스터: `data/pharmalex_unity/merged_pharma_data_20250915_102415.csv`
- HIRA dictionary: `data/hira_master/drug_dictionary_normalized.json`
- NCC 암정보 사전: `ncc/cancer_dictionary/llm_dynamic_results/`

### 관련 문서
- `bridges/INDEX.md`: 전체 데이터 색인
- `bridges/ATC_MAPPING_ANALYSIS.md`: ATC 분석 보고서
- `data/pharmalex_unity/MERGE_ANALYSIS_REPORT.md`: 데이터 통합 과정

---

**최종 수정**: 2025-11-04 16:30
**버전**: v2.0 (HIRA dictionary 조인 완료)
