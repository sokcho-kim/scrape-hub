# ATC 코드 매핑 분석 보고서

## 질문
1. ATC 매핑이 안 된 경우는 없나?
2. ATC가 모든 약가에 존재하는 게 아닌 것으로 아는데?

---

## 조사 결과

### 1. 원천 데이터 구조

#### HIRA 약가 파일 (20221101_20251101 적용약가파일)
- **총 레코드**: 55,398개
- **ATC 코드 필드**: ❌ **없음**
- **있는 것**:
  - 주성분코드 (ingredient_code): 예) `636401ACH`
  - 제품코드 (product_code): 예) `050100010`
  - 품목명, 제조사, 약가 등

#### HIRA drug_dictionary_normalized.json
- **총 레코드**: 201,379개
- **ATC 코드 필드**: ❌ **없음**
- **있는 것**: ingredient_code만

---

### 2. bridges/anticancer_master.csv 구조

```csv
ingredient_ko,atc_code,atc_name_en,brand_names,manufacturers,product_codes,ingredient_code,brand_count
5-fluorouracil,L01BC02,fluorouracil,[...],[...],[...],161430BIJ,5
```

- **ATC 코드**: ✅ **있음** (L01/L02)
- **154개 성분, 1,001개 제품**
- **ATC 코드 100% 존재**

---

### 3. ATC 매핑의 수수께끼

#### ❓ ATC 코드는 어디서 왔나?

**가능한 시나리오:**

1. **외부 매핑 테이블 사용**
   - WHO ATC 공식 데이터베이스
   - 식약처 허가 정보
   - 수동 매핑 테이블

2. **ingredient_code → ATC 매핑**
   ```
   주성분코드 (636401ACH) → ATC (L01EA01)
   ```
   - 건강보험심사평가원 내부 매핑 테이블
   - 또는 수동 작업

3. **품목명 기반 추론**
   - 성분명(ingredient_ko)으로 ATC 검색
   - 예: "imatinib" → L01EA01

#### 🔍 README 힌트

```
항암제 사전 구축 (2025-10-31 Phase 1/4 완료):
- 접근법 전환: 음차 유사도 → 코드 기반 매칭 (ATC 코드)
- Ground Truth: 약가 마스터 1.8M 레코드 → L01/L02 필터링
```

→ **"L01/L02 필터링"**이 가능했다는 것은 **어딘가에 ATC 코드가 있었다**는 의미

---

### 4. 누락 가능성 분석

#### ✅ 현재 데이터 (bridges/anticancer_normalized_v2.csv)
- **ATC 매핑률**: 100% (1,001/1,001)
- **이유**: ATC 코드로 필터링되어 생성됨

#### ⚠️ 원천 데이터 (HIRA 약가 전체)
- **ATC 매핑률**: **알 수 없음** (ATC 필드 자체가 없음)
- **추정**:
  - 전체 55,398개 약제 중 일부만 ATC 매핑되었을 것
  - ATC 코드 없는 항암제는 **누락되었을 가능성 높음**

---

### 5. ATC 코드가 없는 항암제 예시

#### 가능한 케이스:

1. **신약** (ATC 코드 미부여)
   - 최근 허가받은 혁신 신약
   - WHO ATC 분류 대기 중

2. **한약/생약 항암제**
   - 전통적으로 ATC 분류 제외

3. **면역조절제** (경계 사례)
   - 항암 목적으로 사용되지만 L01/L02가 아닌 다른 코드
   - 예: L03 (면역조절제), L04 (면역억제제)

4. **보조 항암제**
   - 항구토제, 백혈구증가제 등
   - 항암 치료에 필수지만 ATC L01/L02가 아님

---

### 6. 검증 방법

#### 누락된 항암제를 찾으려면:

```python
# 1. HIRA 전체 약가에서 항암제로 의심되는 품목명 추출
keywords = ['암', '항암', 'cancer', 'oncology', '종양']

# 2. 의약품 허가정보(MFDS)에서 "항암제" 효능효과 필터링

# 3. 임상시험 데이터에서 항암제 약물 추출

# 4. 현재 bridges 데이터와 비교
```

---

## 결론 및 권장사항

### ✅ 현재 상황

| 항목 | 상태 | 설명 |
|------|------|------|
| **bridges 데이터 ATC 매핑** | 100% | L01/L02로 필터링되어 생성 |
| **원천 HIRA 데이터 ATC 필드** | 없음 | ingredient_code만 존재 |
| **ATC 매핑 방법** | 불명확 | 추가 조사 필요 |
| **누락 가능성** | 높음 | ATC 없는 항암제 누락 추정 |

### ⚠️ 데이터 한계

1. **ATC 코드 있는 항암제만** 포함
2. **신약, 한약, 보조제 등** 누락 가능성
3. **매핑 소스 불명확** → 재현성/검증 어려움

### 💡 권장 조치

#### 단기 (데이터 보완)

1. **식약처 허가정보** 확보
   - 효능효과에 "항암" 포함된 품목
   - ATC 코드 없어도 항암제로 분류

2. **건강보험심사평가원 급여기준** 활용
   - "암질환" 적응증 품목 추출
   - 항암화학요법 고시 목록

3. **ingredient_code → ATC 매핑 테이블** 확보
   - HIRA 내부 자료 요청
   - 또는 WHO ATC 공식 DB와 크로스 매핑

#### 중기 (데이터 통합)

1. **다중 소스 통합**
   ```
   HIRA (제품코드, 약가)
     + MFDS (허가정보, 효능)
     + ATC DB (국제 분류)
     + 급여기준 (임상적 사용)
   → 완전한 항암제 마스터
   ```

2. **품질 검증**
   - 전문가 리뷰
   - 의료기관 실제 사용 데이터 비교

#### 장기 (시스템 구축)

1. **자동 업데이트 파이프라인**
   - 신약 허가 시 자동 추가
   - ATC 코드 부여 시 자동 매핑

2. **버전 관리**
   - 데이터 계보(lineage) 추적
   - 변경 이력 관리

---

## 추가 조사 필요 사항

- [ ] anticancer_master.csv 최초 생성 스크립트 확인
- [ ] ATC 매핑 원본 소스 확인
- [ ] ingredient_code → ATC 매핑 테이블 존재 여부
- [ ] MFDS 허가정보에서 항암제 목록 추출
- [ ] 급여기준 항암화학요법 목록과 비교
- [ ] 의료기관 처방 데이터와 교차 검증

---

**작성일**: 2025-11-04
**작성자**: Claude Code
**버전**: 1.0
