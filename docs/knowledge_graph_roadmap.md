# 약제-암질환 지식그래프 구축 로드맵

**작성일**: 2025-10-29
**목표**: HIRA 약제 데이터 + NCC 암정보를 활용한 지식그래프 구축

---

## 📊 현재 보유 데이터 (최근 3일간 수집)

### 1. HIRA 암질환 사용약제 및 요법 (2025-10-23)
```
✅ 484개 게시글 + 828개 첨부파일
├── 공고 (217건): 471개 PDF/HWP
├── 공고예고 (232건): 299개 PDF/HWP
├── FAQ (117건): 58개 PDF/HWP
└── 항암화학요법 (2건): 다운로드 리스트
```

**데이터 형식**:
- JSON 메타데이터 (8.3MB)
- HTML + 텍스트 본문
- PDF/HWP 첨부파일 (약제 상세 정보)

**포함 정보**:
- 약제명 (성분명, 품명)
- 적응증 (암 종류)
- 투여 방법 (병용, 단독, 용량)
- 급여 기준
- 변경 이력

### 2. NCC 암정보 (2025-10-29)
```
✅ 100개 암종 정보
├── 주요암: 12개
├── 성인암: 97개
└── 소아청소년암: 3개
```

**데이터 구조**:
- 발생부위, 정의, 종류
- 증상, 진단, 치료
- 섹션별 구조화

### 3. NCC 암정보 사전 (2025-10-29)
```
✅ 3,543개 의학 용어
├── 약제명: ~500개
├── 치료법: ~300개
├── 암종 관련: ~200개
└── 기타 의학 용어: ~2,500개
```

**활용**:
- 엔티티 사전
- 용어 정의
- 관계 추출 기반

---

## 🎯 지식그래프 구축 우선순위

### Phase 1: 데이터 파싱 및 엔티티 추출 (즉시 가능) ⭐⭐⭐⭐⭐

#### 1-1. HIRA 공고 문서 파싱 ✅ **완료!** (2025-10-29)
**난이도**: ⭐⭐
**실제 소요 시간**: 3.5시간
**사용 기술**: HTML 파싱, 정규식, 유니코드 처리

```python
# 현재 상태
{
  "content": "자궁암에 'Dostarlimab + Paclitaxel + Carboplatin' 병용요법(1차, 고식적요법) 신설..."
}

# 목표 구조
{
  "cancer_type": "자궁암",
  "drugs": ["Dostarlimab", "Paclitaxel", "Carboplatin"],
  "regimen": "병용요법",
  "line": "1차",
  "purpose": "고식적요법",
  "action": "신설"
}
```

**구현 방법**:
1. HTML content에서 약제명 패턴 추출
   - 패턴: `'약제명 + 약제명 + ...'`
   - 정규식: `'([A-Z][a-z]+(?:\s+\+\s+[A-Z][a-z]+)*)'`
2. 암종 추출
   - 암종 목록 (100개)과 매칭
   - "자궁암에", "폐암에서" 등 패턴
3. 요법 정보 추출
   - "병용요법", "단독요법"
   - "1차", "2차", "3차 이상"
   - "고식적요법", "보조요법"

**활용 데이터**:
- ✅ HIRA JSON (8.3MB) - 즉시 사용 가능
- ✅ NCC 암정보 사전 (3,543개) - 약제명 검증
- ✅ NCC 암종 목록 (100개) - 암종 매칭

**실제 결과**: ✅
- **38개** 약제-암종-요법 관계 추출 (13개 공고에서)
- **16개** 고유 암종 (자궁암, 림프종, 다발골수종, 위암 등)
- **67개** 고유 약제 (Dostarlimab, Paclitaxel, Carboplatin 등)
- **병용요법 14개, 단독요법 12개**
- 출력: `data/hira_cancer/parsed/drug_cancer_relations.json`

**핵심 기술적 해결**:
- 유니코드 Curly Quote (U+2018, U+2019) 패턴 매칭
- 약제명 파싱: `[\u2018\u201c]([A-Z][a-zA-Z0-9\s\+\-\(\)]+?)[\u2019\u201d]`
- 섹션 분리 ('- ', 'ㆍ' 시작 줄)
- Windows 인코딩 처리 (cp949 → UTF-8)

**추가 작업 필요**:
- 나머지 204개 공고는 첨부파일(PDF/HWP)만 보유
- PDF 파싱 시 예상 추가 관계: +500~1,000개

---

#### 1-2. NCC 암정보 사전 구조화 (우선순위: 최고) 🎯 **다음 작업**
**난이도**: ⭐
**예상 소요 시간**: 4-6시간

```python
# 현재
{
  "title": "Paclitaxel",
  "content": "유방암, 폐암 치료에 사용되는..."
}

# 목표
{
  "entity_type": "약제",
  "name": "Paclitaxel",
  "category": "항암제",
  "related_cancers": ["유방암", "폐암"],
  "related_regimens": ["AC-T 요법", "TC 요법"]
}
```

**구현 방법**:
1. 용어 분류
   - 약제: 영문 대문자 시작, "-" 포함
   - 암종: "암" 종료
   - 요법: "요법" 포함
2. 관계 추출
   - content에서 다른 용어 언급 찾기
   - "~에 사용", "~와 병용" 패턴

**활용 데이터**:
- ✅ NCC 사전 (3,543개) - 즉시 사용

**예상 결과**:
- 약제: ~500개
- 암종: ~200개
- 요법: ~300개

---

#### 1-3. PDF 첨부파일 텍스트 추출 (우선순위: 중간)
**난이도**: ⭐⭐⭐
**소요 시간**: 2-3일
**필요 기술**: PDF 파싱, 표 추출

```
현재: PDF 52개 다운로드 완료
목표: 표 형식 데이터 추출
```

**구현 방법**:
1. pdfplumber로 텍스트 추출
2. 표 데이터 추출 (약제 상세 정보)
3. 구조화된 JSON 변환

**활용 데이터**:
- ⚠️ PDF 파일 (52개만 확인) - HWP 파일 변환 필요

**예상 결과**:
- 약 100-200개 상세 약제 정보

---

### Phase 2: 관계 정의 및 그래프 구축 (1주일 소요)

#### 2-1. 그래프 스키마 설계 (우선순위: 높음)
**난이도**: ⭐⭐
**소요 시간**: 1일

```cypher
# 노드 타입
(:Drug {name, generic_name, brand_name})
(:Cancer {name, type, tags})
(:Regimen {name, line, purpose})
(:Guideline {date, source})

# 관계 타입
(Drug)-[:TREATS]->(Cancer)
(Drug)-[:COMBINED_WITH]->(Drug)
(Drug)-[:PART_OF]->(Regimen)
(Regimen)-[:TREATS]->(Cancer)
(Guideline)-[:APPROVES]->(Regimen)
(Guideline)-[:RESTRICTS]->(Regimen)
```

**필요 작업**:
1. 엔티티 타입 정의
2. 관계 타입 정의
3. 속성 정의

---

#### 2-2. Neo4j 데이터베이스 구축 (우선순위: 높음)
**난이도**: ⭐⭐⭐
**소요 시간**: 2-3일

```python
# 예제 삽입 코드
from neo4j import GraphDatabase

driver = GraphDatabase.driver("bolt://localhost:7687")

with driver.session() as session:
    # 약제 노드 생성
    session.run("""
        CREATE (d:Drug {
            name: 'Paclitaxel',
            generic_name: 'Paclitaxel',
            category: '항암제'
        })
    """)

    # 관계 생성
    session.run("""
        MATCH (d:Drug {name: 'Paclitaxel'})
        MATCH (c:Cancer {name: '유방암'})
        CREATE (d)-[:TREATS]->(c)
    """)
```

**필요 작업**:
1. Neo4j 설치 및 설정
2. 데이터 임포트 스크립트 작성
3. 인덱스 생성

---

### Phase 3: RAG 시스템 통합 (2주일 소요)

#### 3-1. 벡터 임베딩 생성 (우선순위: 중간)
**난이도**: ⭐⭐⭐
**소요 시간**: 3-4일

```python
from sentence_transformers import SentenceTransformer

model = SentenceTransformer('paraphrase-multilingual-mpnet-base-v2')

# 각 노드에 임베딩 추가
for drug in drugs:
    embedding = model.encode(drug['content'])
    drug['embedding'] = embedding.tolist()
```

**필요 작업**:
1. 임베딩 모델 선택
2. 전체 엔티티 임베딩 생성
3. 벡터 DB 저장 (ChromaDB)

---

#### 3-2. 하이브리드 검색 구현 (우선순위: 중간)
**난이도**: ⭐⭐⭐⭐
**소요 시간**: 5-7일

```python
def hybrid_search(query):
    # 1. 벡터 검색
    similar_docs = vector_search(query, top_k=5)

    # 2. 엔티티 추출
    entities = extract_entities(query)

    # 3. 그래프 탐색
    related = graph_traverse(entities, depth=2)

    # 4. 컨텍스트 구성
    context = merge(similar_docs, related)

    # 5. LLM 생성
    answer = llm.generate(query, context)

    return answer
```

---

## 📋 즉시 실행 가능한 작업 (우선순위 TOP 5)

### 🥇 1순위: HIRA 공고 문서 파싱 스크립트 작성
**왜 1순위인가?**
- 데이터 즉시 사용 가능 (JSON 8.3MB)
- 코드만 작성하면 바로 실행 가능
- 가장 구조화된 정보 (약제-암종-요법 관계)
- PDF 파싱 없이도 충분한 정보 추출 가능

**예상 작업 시간**: 4-6시간
**필요 스킬**: Python, 정규식, HTML 파싱

**작업 내용**:
```
1. hira_cancer/parsers/entity_extractor.py 작성
2. 약제명 패턴 추출 (정규식)
3. 암종 매칭 (NCC 100개 목록)
4. 요법 정보 추출
5. JSON 출력
```

**예상 결과**:
- 500-1,000개 (약제, 암종, 요법) 트리플 생성

---

### 🥈 2순위: NCC 암정보 사전 엔티티 분류
**왜 2순위인가?**
- 데이터 즉시 사용 가능 (3,543개)
- 간단한 규칙 기반 분류 가능
- 1순위 작업과 독립적 (병렬 실행 가능)

**예상 작업 시간**: 4시간

**작업 내용**:
```
1. ncc/cancer_dictionary/entity_classifier.py 작성
2. 약제/암종/요법 자동 분류
3. 카테고리별 JSON 출력
```

**예상 결과**:
- 약제: 500개
- 암종: 200개
- 요법: 300개

---

### 🥉 3순위: 그래프 스키마 설계 문서 작성
**왜 3순위인가?**
- 코드 작성 전 설계 필요
- 1, 2순위 결과를 기반으로 스키마 확정 가능

**예상 작업 시간**: 3-4시간

**작업 내용**:
```
1. 노드 타입 정의
2. 관계 타입 정의
3. 속성 정의
4. Cypher 쿼리 예제 작성
```

---

### 4순위: Neo4j 설치 및 초기 데이터 임포트
**왜 4순위인가?**
- 1, 2, 3순위 완료 후 시작 가능
- 환경 설정 필요

**예상 작업 시간**: 1일

---

### 5순위: HIRA PDF 파싱 (표 추출)
**왜 5순위인가?**
- HWP 파일 변환 필요 (복잡)
- PDF만 52개로 제한적
- 1순위(공고 텍스트)만으로도 충분한 정보

**예상 작업 시간**: 2-3일

---

## 🚀 1주일 마일스톤

### Day 1-2: 엔티티 추출
- [x] HIRA 공고 파싱 스크립트 완성
- [x] NCC 사전 엔티티 분류 완성
- [x] 추출된 엔티티 JSON 저장

**예상 결과**:
```json
{
  "drugs": ["Paclitaxel", "Carboplatin", ...],
  "cancers": ["자궁암", "폐암", ...],
  "regimens": ["AC-T 요법", ...],
  "relations": [
    {
      "drug": "Paclitaxel",
      "cancer": "유방암",
      "regimen": "AC-T 요법",
      "line": "1차"
    }
  ]
}
```

### Day 3: 그래프 스키마 설계
- [ ] 노드/관계 타입 정의
- [ ] 속성 정의
- [ ] Cypher 쿼리 작성

### Day 4-5: Neo4j 구축
- [ ] Neo4j 설치
- [ ] 데이터 임포트
- [ ] 인덱스 생성
- [ ] 기본 쿼리 테스트

### Day 6-7: 검증 및 시각화
- [ ] 데이터 품질 검증
- [ ] 그래프 시각화 (Neo4j Browser)
- [ ] 쿼리 성능 테스트

---

## 🔄 다음 단계 (2주차 이후)

1. **벡터 임베딩 추가**
   - 각 엔티티 임베딩 생성
   - ChromaDB 저장

2. **하이브리드 검색 구현**
   - 벡터 + 그래프 통합
   - RAG 파이프라인 구축

3. **웹 인터페이스 개발**
   - 검색 UI
   - 그래프 시각화
   - 질의응답 시스템

---

## 📊 현재 데이터 활용도 분석

### 즉시 활용 가능 (100%)
- ✅ HIRA JSON (8.3MB, 484건)
- ✅ NCC 사전 (3,543개)
- ✅ NCC 암정보 (100개)

### 추가 작업 필요 (50%)
- ⚠️ HIRA PDF (52개만) - 나머지 HWP 변환 필요
- ⚠️ 관계 자동 추출 - 규칙 기반 → ML 기반으로 개선 필요

### 장기 과제 (0%)
- ❌ 실시간 업데이트 (HIRA 월간 공고)
- ❌ 다국어 지원
- ❌ 외부 지식베이스 연동 (DrugBank, PubMed)

---

## 💡 핵심 인사이트

### 강점
1. **데이터 품질이 높음**
   - HIRA 공식 데이터
   - NCC 전문가 검증 정보
   - 구조화된 형식 (JSON)

2. **즉시 활용 가능**
   - 코드만 작성하면 바로 실행
   - 추가 데이터 수집 불필요

3. **도메인 특화**
   - 한국 암질환 약제
   - 급여 기준 포함 (독보적)

### 약점
1. **HWP 파일 처리 복잡**
   - 299개 중 대부분 HWP
   - 변환 도구 필요

2. **자동 업데이트 필요**
   - HIRA 월간 공고
   - 수동 재수집 vs 자동화

### 기회
1. **한국어 의료 RAG 최초**
   - 국내 유일 데이터셋
   - 논문/서비스 가능

2. **실용성 높음**
   - 의사, 약사 활용 가능
   - 환자 정보 제공

---

## 🎯 최종 권장사항

### 지금 당장 시작할 것 (오늘~내일)
1. **HIRA 공고 파싱 스크립트 작성** (6시간)
2. **NCC 사전 엔티티 분류** (4시간)

### 이번 주 안에 완료할 것
3. **그래프 스키마 설계** (4시간)
4. **Neo4j 기본 구축** (1일)

### 다음 주에 시작할 것
5. **벡터 임베딩 추가**
6. **RAG 파이프라인 구현**

---

**예상 최소 기능 구현 시간**: 1주일
**예상 완전 기능 구현 시간**: 3-4주간

