# Neo4j v2.0 업그레이드 및 데이터 분석 - 2025년 11월 9일

## 📋 작업 개요

v1.0 (17개 바이오마커) → v2.0 (23개 바이오마커)로 업그레이드 및 그래프 데이터 분석 수행

---

## ✅ 완료 사항

### 1. v2.0 바이오마커로 업그레이드

**변경**:
- 파일: `neo4j/scripts/integrate_to_neo4j.py:30`
- `biomarkers_extracted.json` → `biomarkers_extracted_v2.json`

**결과**:
```
노드:
├── Biomarker: 17개 → 23개 (+6개)
├── Test: 575개
└── Drug: 138개
총계: 730개 → 736개

관계:
├── TESTED_BY: 996개
└── TARGETS: 71개
총계: 1,067개 (동일)
```

---

## 📊 데이터 분석 결과

### 기본 통계

**노드**:
- Test: 575개 (78.1%)
- Drug: 138개 (18.8%)
- Biomarker: 23개 (3.1%)
- **총 736개**

**관계**:
- TESTED_BY: 996개 (93.3%) - 바이오마커 → 검사
- TARGETS: 71개 (6.7%) - 약물 → 바이오마커
- **총 1,067개**

---

### 바이오마커 분석

#### 1. 검사 수 기준 상위 바이오마커 (Top 10)

| 순위 | 바이오마커 | 한글명 | 검사 수 |
|------|-----------|--------|---------|
| 1 | EGFR | EGFR 수용체 | 424개 |
| 2 | CDK4/6 | CDK4/6 | 424개 |
| 3 | IDH2 | IDH2 | 104개 |
| 4 | CD38 | CD38 | 11개 |
| 5 | BCR-ABL | BCR-ABL 융합 유전자 | 8개 |
| 6 | ALK | ALK 융합 유전자 | 6개 |
| 7 | IDH1 | IDH1 | 4개 |
| 8 | CD20 | CD20 | 3개 |
| 9 | BRAF | BRAF 돌연변이 | 3개 |
| 10 | BRCA2 | BRCA2 돌연변이 | 2개 |

**인사이트**:
- **EGFR과 CDK4/6**이 압도적 (각 424개, 18.4%)
- 상위 3개가 전체의 51.7% 차지
- IDH1/IDH2는 v2.0에서 추가됨 (HINS 발견)

#### 2. 바이오마커 타입별 분포

| 타입 | 개수 | 비율 |
|------|------|------|
| protein (단백질) | 12개 | 52.2% |
| mutation (돌연변이) | 4개 | 17.4% |
| enzyme (효소) | 4개 | 17.4% |
| fusion_gene (융합 유전자) | 3개 | 13.0% |

---

### 약물 분석

#### 1. 바이오마커별 타겟 약물 수

| 바이오마커 | 한글명 | 약물 수 |
|-----------|--------|---------|
| EGFR | EGFR 수용체 | 11개 🥇 |
| ALK | ALK 융합 유전자 | 8개 |
| BCR-ABL | BCR-ABL 융합 유전자 | 7개 |
| PD-1 | PD-1 | 7개 |
| PD-L1 | PD-L1 | 7개 |
| ROS1 | ROS1 융합 유전자 | 5개 |
| VEGF | VEGF 수용체 | 4개 |
| AR | 안드로겐 수용체 | 3개 |
| CDK4/6 | CDK4/6 | 3개 |
| CD20 | CD20 | 2개 |
| CD38 | CD38 | 2개 |
| ER | 에스트로겐 수용체 | 2개 |
| MEK | MEK | 2개 |
| PARP | PARP | 2개 |
| BRAF | BRAF 돌연변이 | 1개 |
| HER2 | HER2 수용체 | 1개 |
| mTOR | mTOR | 1개 |

**인사이트**:
- **EGFR**이 가장 많은 약물 타겟 (11개)
- 면역관문억제제 타겟 (PD-1, PD-L1)이 각 7개
- 총 17개 바이오마커가 약물 타겟으로 사용됨

#### 2. ATC Level 3 분류별 약물 수 (Top 10)

| ATC L3 | 분류명 | 개수 |
|--------|--------|------|
| L01EX | 기타 단백질 키나아제 억제제 | 10개 |
| L01XX | 기타 | 9개 |
| L01BC | 피리미딘 유사체 | 8개 |
| L01EA | BCR-ABL 티로신 키나아제 억제제 | 7개 |
| L01FF | 염증억제제 | 6개 |
| L01EB | EGFR 티로신 키나아제 억제제 | 6개 |
| L01ED | ALK/ROS1 티로신 키나아제 억제제 | 5개 |
| L01DB | 안트라사이클린 | 5개 |
| L01FX | 기타 면역자극 인자 | 4개 |
| L01AA | 질소 머스타드 유사체 | 4개 |

**인사이트**:
- 키나아제 억제제가 주류 (L01EX, L01EA, L01EB, L01ED)
- 표적치료제 중심의 데이터셋

---

### 검사 분석

#### 1. 검사 카테고리별 분포

| 카테고리 | 개수 | 비율 |
|---------|------|------|
| 기타 | 555개 | 96.5% |
| 유전자염기서열검사 | 14개 | 2.4% |
| 염색체화학검사 | 6개 | 1.0% |

**인사이트**:
- 대부분 "기타" 카테고리로 분류
- 유전자 검사 및 염색체 검사 비중 낮음

#### 2. 표준 코드 보유율

| 코드 체계 | 보유 | 전체 | 비율 |
|----------|------|------|------|
| SNOMED CT | 543개 | 575개 | **94.4%** 🌟 |
| LOINC | 258개 | 575개 | **44.9%** |

**인사이트**:
- **SNOMED CT 보유율 매우 높음** (94.4%)
- LOINC는 상대적으로 낮음 (44.9%)
- 국제 표준 코드 기반 매칭 전략 성공적

---

### v2.0 신규 바이오마커 (6개)

#### HINS에서만 발견된 바이오마커 (6개)

| 바이오마커 | 한글명 | 타입 | 출처 |
|-----------|--------|------|------|
| BRCA1 | BRCA1 돌연변이 | mutation | hins_only |
| BRCA2 | BRCA2 돌연변이 | mutation | hins_only |
| FLT3 | FLT3 | protein | hins_only |
| IDH1 | IDH1 | enzyme | hins_only |
| IDH2 | IDH2 | enzyme | hins_only |
| KRAS | KRAS 돌연변이 | mutation | hins_only |

#### 약물과 HINS 양쪽에서 발견된 바이오마커 (7개)

| 바이오마커 | 한글명 | 타입 | 출처 |
|-----------|--------|------|------|
| ALK | ALK 융합 유전자 | fusion_gene | drug_and_hins |
| BCR-ABL | BCR-ABL 융합 유전자 | fusion_gene | drug_and_hins |
| BRAF | BRAF 돌연변이 | mutation | drug_and_hins |
| EGFR | EGFR 수용체 | protein | drug_and_hins |
| HER2 | HER2 수용체 | protein | drug_and_hins |
| PD-L1 | PD-L1 | protein | drug_and_hins |
| ROS1 | ROS1 융합 유전자 | fusion_gene | drug_and_hins |

**v2.0 통계**:
- 총 23개 바이오마커
- 약물만: 10개
- HINS만: 6개 ⭐ (신규 발견)
- 양쪽 모두: 7개

**인사이트**:
- **BRCA1/BRCA2**: 유방암/난소암 주요 바이오마커
- **KRAS**: 폐암/대장암 주요 바이오마커
- **FLT3**: 급성골수성백혈병(AML) 바이오마커
- **IDH1/IDH2**: 뇌종양/백혈병 바이오마커

---

## 🎯 주요 발견사항

### 1. 데이터 품질
✅ **매우 높은 표준 코드 보유율**
- SNOMED CT: 94.4%
- LOINC: 44.9%
- 국제 표준 기반 데이터 통합 성공

### 2. 바이오마커 커버리지
✅ **v2.0으로 6개 추가**
- BRCA1/2, KRAS, FLT3, IDH1/2
- 주요 암종의 핵심 바이오마커 포함

### 3. 약물-바이오마커 매핑
✅ **71개 약물-바이오마커 관계**
- EGFR 타겟 약물 11개 (최다)
- 17개 바이오마커가 약물 타겟

### 4. 검사-바이오마커 매핑
✅ **996개 검사-바이오마커 관계**
- EGFR/CDK4/6 각 424개 검사 (최다)
- 평균 43.3개 검사/바이오마커

---

## 📈 데이터 활용 가능성

### 1. 임상 의사결정 지원
```cypher
// 특정 바이오마커에 대한 약물-검사 매칭
MATCH path = (d:Drug)-[:TARGETS]->(b:Biomarker {name_en: 'EGFR'})-[:TESTED_BY]->(t:Test)
RETURN d.ingredient_ko, t.name_ko, t.edi_code
```
→ EGFR 양성 환자에게 사용 가능한 약물과 필요한 검사 조회

### 2. 보험 청구 최적화
```cypher
// EDI 코드 기반 검사-약물 연계
MATCH (d:Drug)-[:TARGETS]->(b:Biomarker)-[:TESTED_BY]->(t:Test)
WHERE t.edi_code IS NOT NULL
RETURN t.edi_code, collect(DISTINCT d.ingredient_ko) as drugs
```
→ EDI 코드로 검사와 약물 연계 조회

### 3. 연구 및 개발
```cypher
// 바이오마커별 약물 개발 현황
MATCH (d:Drug)-[:TARGETS]->(b:Biomarker)
RETURN b.name_en, count(d) as drug_count
ORDER BY drug_count DESC
```
→ 개발이 활발한 바이오마커 파악

---

## 📝 생성된 파일

### 신규 생성
- `neo4j/scripts/analyze_graph.py` - 그래프 분석 스크립트
- `docs/journal/2025-11-09_neo4j_v2_analysis.md` (이 파일)

### 수정
- `neo4j/scripts/integrate_to_neo4j.py:30` - v2.0 파일로 변경

---

## ⏱️ 작업 시간

- **v2.0 업그레이드**: 5분
- **분석 스크립트 작성**: 15분
- **데이터 분석 실행**: 5분
- **문서화**: 15분
- **총 소요**: 약 40분

---

## 🚀 다음 단계

### 즉시 가능
- [ ] Neo4j Browser에서 시각화
- [ ] 추가 쿼리 개발 (암종별, 치료법별)
- [ ] 데이터 시각화 대시보드

### 향후 계획
- [ ] v2.0 매핑 데이터 재생성 (23개 바이오마커 기준)
- [ ] 암종-바이오마커 관계 추가
- [ ] 벡터 DB 연동
- [ ] RAG 시스템 구축

---

## 💡 인사이트 요약

1. **EGFR이 핵심**: 가장 많은 약물(11개)과 검사(424개)
2. **v2.0의 가치**: BRCA, KRAS 등 주요 바이오마커 6개 추가
3. **표준 코드 우수**: SNOMED CT 94.4% 보유
4. **데이터 균형**: 표적치료제 중심, 키나아제 억제제 주류
5. **실용성 높음**: EDI 코드 기반 보험 청구 활용 가능

---

**작성일**: 2025-11-09
**상태**: ✅ v2.0 업그레이드 완료, 분석 완료
**Neo4j**: 736개 노드, 1,067개 관계
