# NCC (국립암센터) 암정보 스크래퍼

## 프로젝트 개요

**목적**: 국립암센터(National Cancer Center) 암정보 사이트에서 교육/임상 자료 수집

**대상 사이트**: https://www.cancer.go.kr

**수집 범위**:
- **전체 100개 암종** 정보 (12대 주요암 + 성인 암 + 소아청소년 암)
- 항암화학요법 정보 (세포독성 항암제, 표적치료제, 면역관문억제제, 면역세포치료)
- 암종별 상세 정보 (발생부위, 정의, 위험요인, 예방법, 진단, 치료 등)

---

## 폴더 구조

```
ncc/
├── README.md                   # 프로젝트 문서
├── scraper.py                  # Phase 1 스크래퍼 (항암화학요법)
├── scraper_v2.py               # Phase 2 스크래퍼 (전체 암종)
├── config.py                   # 설정 (100개 암종, 태그 시스템)
├── test_v2.py                  # 단일 암종 테스트
└── analyze_collection.py       # 수집 결과 분석

data/ncc/
├── parsed/                     # 파싱된 JSON (107개 파일)
│   ├── [Phase 1] 항암화학요법 (5개)
│   ├── [Phase 2] 암종 데이터 (100개)
│   └── [Summary] 요약 파일 (2개)
└── logs/                       # 스크래핑 로그
```

---

## 사이트 구조 분석

### URL 패턴

```
기본 패턴: /lay1/S1T[분류코드]C[상세코드]/[타입].do

예시:
- /lay1/S1T289C290/contents.do (항암화학요법의 이해)
- /lay1/S1T282C289/sublink.do (항암화학요법 목록)
- /lay1/program/S1T211C212/cancer/list.do (갑상선암)
```

### 메뉴 구조

**대분류**:
1. 암예방과 검진
2. **내가 알고 싶은 암** ⭐ (주요 스크래핑 대상)
   - 암의 종류 (갑상선암, 폐암, 위암, 대장암, 간암, 유방암 등)
   - 암이란 (정의, 발생부위, 발생기전)
   - 진단 (증상, 진단방법, CT검사, 진행단계)
   - **치료** (치료원칙, 수술, 항암화학요법, 방사선치료) ⭐
   - 임상시험
   - 재발·전이
   - 말기 암환자
3. 암환자 생활백서
4. 통계로 보는 암
5. 암정보 나눔터

---

## 스크래핑 전략

### Phase 1: 항암화학요법 정보 수집 ✅ 완료

**대상 페이지** (5개):
- 항암화학요법의 이해
- 세포독성 항암제
- 표적치료제
- 면역관문억제제
- 면역세포치료

**수집 데이터**:
- 약물 분류 및 작용 원리
- 항암제 종류 및 특성
- 투여 방법 및 기간
- 효과 평가 기준 (CR, PR, PD, SD)

**결과**: 5개 페이지 수집 완료

---

### Phase 2: 전체 암종 정보 수집 ✅ 완료

**수집 범위**: **전체 100개 암종**
- 12대 주요암 (갑상선암, 위암, 대장암, 폐암, 간암, 유방암, 전립선암, 췌장암, 담낭암, 담도암, 신장암, 방광암)
- 성인 암: 97개
- 소아청소년 암: 3개 (뇌종양, 림프종, 백혈병)

**태그 시스템**:
```json
{
  "name": "갑상선암",
  "cancer_seq": "3341",
  "tags": ["주요암", "성인"],  // 유연한 다중 분류
  "content": { ... }
}
```

**수집 항목** (암종당):
- 발생부위
- 정의 및 종류
- 위험요인
- 예방법
- 일반적 증상
- 진단 방법
- 치료 (수술, 항암화학요법, 방사선치료)
- 치료 부작용
- 재발 및 전이

**결과**:
- 100/100 암종 수집 완료 (성공률 100%)
- 평균 8.9개 섹션/암종
- 총 934개 섹션, 8개 표, 91개 이미지

### Phase 3: 추가 자료 수집

- 임상시험 정보
- 치료 효과 평가 기준
- 부작용 및 관리

---

## 수집 데이터 구조

### Raw HTML
```
data/ncc/raw/
  treatment/
    chemotherapy_overview.html
    cytotoxic_drugs.html
    targeted_therapy.html
    ...
  cancer_types/
    thyroid_cancer/
      definition.html
      diagnosis.html
      treatment.html
      ...
```

### Parsed JSON (Phase 2 예시)
```json
{
  "name": "갑상선암",
  "cancer_seq": "3341",
  "tags": ["주요암", "성인"],
  "url": "https://www.cancer.go.kr/lay1/program/S1T211C223/cancer/view.do?cancer_seq=3341",
  "category": "주요암 > 성인",
  "content": {
    "sections": [
      {
        "heading": "발생부위",
        "level": "h6",
        "content": "갑상선(thyroid)은 목 앞쪽에 튀어나와 있는..."
      },
      {
        "heading": "정의와 종류",
        "level": "h6",
        "content": "갑상선에 혹이 생긴 것을 갑상선 결절이라 하며..."
      }
    ],
    "tables": [
      {
        "title": "갑상선암 병기별 분류",
        "headers": ["병기", "설명"],
        "rows": [...]
      }
    ],
    "images": [
      {
        "url": "https://www.cancer.go.kr/...",
        "alt": "갑상선 위치"
      }
    ],
    "raw_text": "전체 텍스트..."
  },
  "metadata": {
    "scraped_at": "2025-10-29T15:47:23.456789",
    "scraper_version": "2.0"
  }
}
```

---

## 기술 스택

- **Playwright**: 동적 콘텐츠 렌더링 및 스크래핑
- **BeautifulSoup4**: HTML 파싱
- **Python 3.12+**: 메인 언어
- **asyncio**: 비동기 처리

---

## 실행 방법

### 1. 환경 설정
```bash
# 가상환경 활성화
. scraphub/Scripts/activate

# Playwright 브라우저 설치 (처음 한번만)
playwright install chromium
```

### 2. 스크래핑 실행
```bash
# Phase 1: 항암화학요법 정보 (5개 페이지)
scraphub/Scripts/python ncc/scraper.py phase1

# Phase 2: 전체 100개 암종
scraphub/Scripts/python ncc/scraper_v2.py phase2_all

# 단일 암종 테스트
scraphub/Scripts/python ncc/test_v2.py

# 수집 결과 분석
scraphub/Scripts/python ncc/analyze_collection.py
```

---

## 수집 완료 현황

| Phase | 카테고리 | 수집량 | 상태 |
|-------|----------|--------|------|
| 1 | 항암화학요법 | 5개 페이지 | ✅ 완료 |
| 2 | 전체 암종 | 100개 암종 | ✅ 완료 |
| **합계** | | **105개** | ✅ |

### 세부 통계
- **총 파일 수**: 107개 (데이터 105 + 요약 2)
- **성공률**: 100% (100/100 암종)
- **평균 콘텐츠**: 8.9 섹션/암종
- **총 섹션**: 934개
- **총 표**: 8개
- **총 이미지**: 91개

---

## 데이터 활용 계획

1. **약제명 매칭 보강**: HIRA 암질환 데이터 매칭률 향상
2. **의학용어 사전 구축**: 치료 방법, 평가 기준 등 표준 용어 수집
3. **암종별 표준 치료 프로토콜**: 치료 가이드라인 정리
4. **항암제 분류 체계**: 세대별, 작용기전별 분류 정립

---

## 주의사항

- **robots.txt 확인**: 스크래핑 허용 여부 사전 확인
- **Rate Limiting**: 요청 간격 2-3초 유지
- **User-Agent 설정**: 정중한 봇 식별
- **저작권 준수**: 교육/연구 목적 명시

---

## 진행 상황

- [x] **Phase 1: 항암화학요법 정보 수집** (5/5 완료)
- [x] **Phase 2: 전체 암종 정보 수집** (100/100 완료)
- [x] **태그 시스템 구축** (주요암, 성인, 소아청소년)
- [x] **노이즈 필터링 개선** (네비게이션, SNS 링크 제거)
- [ ] Phase 3: 추가 자료 수집 (필요시)
- [ ] HIRA 데이터와 연계 분석

---

## 참고 문서

- `docs/journal/ncc/2025-10-29_phase2_full_collection.md`: Phase 2 전체 작업 일지
- `docs/journal/hira_cancer/2025-10-29_drug_matching_improvement.md`: 약제명 매칭 현황
- `docs/TODO_KCD.md`: KCD 코드 매칭 계획

---

## 주요 개선사항 (v2.0)

### 1. 태그 시스템
- **기존**: 카테고리 기반 분리
- **개선**: JSON 내 tags 배열로 유연한 다중 분류
- **장점**: 하나의 암종이 여러 태그 보유 가능 (예: ["주요암", "성인"])

### 2. URL 패턴 통일
- **기존**: 각 암종마다 다른 카테고리 URL
- **개선**: `cancer_seq` 기반 단일 패턴
- **URL**: `view.do?cancer_seq={cancer_seq}`

### 3. 노이즈 필터링 강화
- 네비게이션 메뉴, SNS 링크, breadcrumb 제거
- h4, h5, h6만 추출 (h2, h3는 네비게이션)
- 아이콘/버튼 이미지 자동 제외

### 4. 파일명 고유성
- **형식**: `{암종명}_{cancer_seq}.json`
- **장점**: 동명 암종 충돌 방지

---

## 성능 지표

- **총 수집 시간**: ~5-6분 (100개 암종)
- **요청 간격**: 2초/암종
- **평균 처리 시간**: ~3초/암종
- **성공률**: 100%
- **총 데이터 크기**: ~15-20MB
