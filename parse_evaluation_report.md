# 질병코딩지침서 PDF 파싱 결과 평가 보고서

## 📊 파싱 결과 요약

- **원본**: 붙임1_2021년+한국표준질병사인분류+질병코딩지침서.pdf
- **총 페이지**: 128 페이지
- **분할 방식**: 50페이지씩 3개 청크
- **파싱 성공**: 3/3 청크 (100%)
- **추출 데이터**:
  - 총 210,650자
  - 1,500개 elements
  - 413개 headings

## 🔍 주요 문서 구조 (목차 기반)

### 1. 질병분류지침서 이용 안내 (p.3-5)
- 지침서 구조, 규약, 분류지침 설명

### 2. 한국표준질병·사인분류 코드체계 및 규약 (p.9-13)
- DConvention.1~7: KCD 구성, 체계, 규약

### 3. 일반분류지침 (p.17-25)
- DGCG.1~14: 급성/만성, 결합코드, 주진단 등

### 4. 장 및 질환별 분류지침 (p.29-107)

| 장 | 내용 | 페이지 범위 |
|---|------|------------|
| I | 특정 감염성 및 기생충성 질환 (A00-B99) | p.29-33 |
| II | 신생물 (C00-D48) | p.34-41 |
| III | 혈액 및 조혈기관의 질환 (D50-D89) | p.42 |
| IV | 내분비, 영양 및 대사 질환 (E00-E90) | p.43-46 |
| V | 정신 및 행동장애 (F00-F99) | p.47-51 |
| VI | 신경계통의 질환 (G00-G99) | p.52-54 |
| VII-VIII | 눈/귀 질환 (H00-H95) | p.55-56 |
| IX | 순환계통의 질환 (I00-I99) | p.57-61 |
| X | 호흡계통의 질환 (J00-J99) | p.62-64 |
| XI | 소화계통의 질환 (K00-K93) | p.65-67 |
| XII | 피부 질환 (L00-L99) | p.68 |
| XIII | 근골격계통 질환 (M00-M99) | p.69-73 |
| XIV | 비뇨생식계통 질환 (N00-N99) | p.74-75 |
| XV | 임신, 출산 및 산후기 (O00-O99) | p.76-83 |
| XVI | 출생전후기 병태 (P00-P96) | p.84-86 |
| XVII | 선천기형 (Q00-Q99) | p.87 |
| XVIII | 증상, 징후 (R00-R99) | p.88-89 |
| XIX | 손상, 중독 (S00-T98) | p.90-96 |
| XX | 외인 (V01-Y98) | p.97-99 |
| XXI | 건강상태/보건서비스 (Z00-Z99) | p.100-103 |
| XXII | 특수목적 코드 (U00-U99) | p.104 |
| XXIII | 한의분류 (U22-U98) | p.104-105 |

### 5. 부록 (p.107~)

## ⚠️ 현재 분할 방식의 문제점

### 1. **데이터 파편화 발생**

#### 첫 번째 분할 지점 (50페이지)
- **위치**: 제II장 신생물 > DCG.II.2 전이부위 신생물 분류 **중간**
- **문제**:
  - 청크1 끝: "DCG.II.2: 전이부위 신생물 분류" 섹션 시작 + 설명 일부
  - 청크2 시작: DCG.II.2 섹션의 나머지 예시들
  - **결과**: 하나의 코딩 지침이 두 청크로 분리됨

#### 두 번째 분할 지점 (100페이지)
- **위치**: 제XXI장 건강상태 및 보건서비스 접촉 섹션 **중간**
- **문제**:
  - 청크2 끝: XXI장 일부 지침
  - 청크3 시작: XXI장 나머지 + XXII, XXIII장
  - **결과**: 장(Chapter) 단위가 분리됨

### 2. **목차 구조 무시**
- 단순히 페이지 수로만 분할 (1-50, 51-100, 101-128)
- 주요 장(Chapter) 경계를 고려하지 않음
- 개별 코딩 지침(DCG) 단위도 고려하지 않음

### 3. **문맥 손실 가능성**
- 각 청크를 독립적으로 분석할 때 문맥 끊김
- 예: "DCG.II.2" 지침의 전반부와 후반부가 분리되어 있으면
  - LLM 기반 분석 시 지침의 전체 맥락 파악 어려움
  - 질병 코드 매핑 작업 시 불완전한 정보 참조

## ✅ 개선 방안

### 방안 1: **목차 기반 지능형 분할**

#### 전략
1. PyMuPDF로 목차 추출 또는 heading 패턴 분석
2. 주요 장(Chapter) 경계 식별
3. 페이지 수 제한 내에서 장 경계에 맞춰 분할

#### 구현 예시
```python
# 목차 분석 결과 기반 분할 지점 제안
- 청크 1: p.1-41   (이용안내 + 규약 + 일반지침 + I~II장)
- 청크 2: p.42-89  (III~XVIII장)
- 청크 3: p.90-128 (XIX~XXIII장 + 부록)
```

**장점**:
- 각 청크가 의미 있는 단위로 구성
- 문맥 보존
- 장 단위 독립 분석 가능

**단점**:
- 청크 크기 불균등 (41p, 48p, 39p)
- 목차 추출 로직 필요

### 방안 2: **헤딩 경계 고려 동적 분할**

#### 전략
1. 50페이지 기준 분할 지점 설정
2. 분할 지점 ±5페이지 범위에서 가장 가까운 heading1 경계 찾기
3. heading1 (주요 장 또는 DCG 지침) 경계에서 분할

#### 구현 예시
```python
target_pages = [50, 100]
tolerance = 5

for target in target_pages:
    # target ±5 페이지 범위에서 heading1 찾기
    heading_pages = find_headings_in_range(target-tolerance, target+tolerance)
    split_page = closest_heading_page(heading_pages, target)
```

**장점**:
- 청크 크기 비교적 균등
- 주요 섹션 경계 보존
- 유연한 분할

**단점**:
- heading 추출 정확도에 의존
- 여전히 일부 sub-section 분리 가능성

### 방안 3: **중첩(Overlap) 분할**

#### 전략
1. 50페이지 단위로 분할하되, 앞뒤 5-10페이지 중첩
2. 각 청크에 이전/다음 섹션의 일부 포함

#### 구현 예시
```python
# 중첩 분할
- 청크 1: p.1-55   (50페이지 + 5페이지 overlap)
- 청크 2: p.46-105 (45-100 + 5페이지 overlap)
- 청크 3: p.96-128 (95-128)
```

**장점**:
- 문맥 손실 최소화
- 분할 지점의 내용이 두 청크에 모두 존재
- 간단한 구현

**단점**:
- 중복 데이터로 인한 토큰 사용량 증가
- 병합 시 중복 제거 로직 필요

## 🎯 권장 사항

### 단기 (현재 파싱 결과 활용)
**현재 파싱 결과는 전체 문서 검색/참조용으로는 충분히 사용 가능**
- 210,650자의 전체 텍스트가 병합되어 있음
- 키워드 검색, 전체 내용 리뷰에는 문제 없음

### 중기 (지능형 분할 적용)
**목차 기반 지능형 분할 (방안 1 + 방안 2 조합) 추천**

1. **1단계**: PyMuPDF로 전체 페이지 스캔 → 목차 구조 추출
2. **2단계**: 주요 장(Chapter) 경계 리스트 생성
3. **3단계**: 50페이지 기준으로 분할하되, ±10페이지 내에서 가장 가까운 장 경계 선택
4. **4단계**: 각 청크 메타데이터에 포함된 장 정보 추가

#### 예상 분할 결과
```
청크 1: p.1-42   (규약 + 일반지침 + I~II장)    - 42페이지
청크 2: p.43-90  (III~XVIII장)                - 48페이지
청크 3: p.91-128 (XIX~XXIII장 + 부록)        - 38페이지
```

### 장기 (고급 분석 준비)
**Semantic Chunking 도입**
- 내용 기반 의미 단위 분할
- 임베딩 기반 유사도 분석
- 각 코딩 지침(DCG) 단위로 독립 문서화

## 📝 결론

### 현재 상태
✅ **파싱 자체는 성공**: 모든 텍스트와 구조 정보 추출 완료
⚠️ **개선 필요**: 분할 방식이 문서 구조를 고려하지 않아 데이터 파편화 발생

### 다음 단계
1. **즉시**: 현재 파싱 결과를 전체 문서 검색/분석에 활용
2. **개선**: 목차 기반 지능형 분할 스크립트 작성 (권장)
3. **고도화**: Semantic chunking으로 각 지침 단위 문서화 (선택)

### 우선순위
- **High**: 방안 1 (목차 기반 분할) 구현 - 가장 실용적
- **Medium**: 방안 2 (헤딩 경계 동적 분할) 추가 - 유연성 확보
- **Low**: 방안 3 (중첩 분할) - 토큰 낭비 우려

---

**생성일**: 2025-11-04
**평가 대상**: 붙임1_2021년+한국표준질병사인분류+질병코딩지침서.pdf
**파싱 방식**: pypdf 50페이지 분할 + Upstage Document Parse API
